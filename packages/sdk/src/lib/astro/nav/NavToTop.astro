---
/* import type { HTMLAttributes } from 'astro/types'; */
import twMerge from '../../tailwind/tailwind-merge';

type Props = /* Omit<HTMLAttributes<'button'>, 'class'> & */ {
  class?: ClassName;
  duration?: number;
  size?: string | number;
  speed?: number;
};
const { class: className, duration = 300, size = 32, speed: move, ...props } = Astro.props;

const speed = move ?? duration * 3;
---

<button
  is='app-to-top'
  class={twMerge(
    'flex absolute top-full z-10',
    'disabled scale-0 origin-center opacity-50 hover:opacity-100',
    'onscroll:enabled onscroll:scale-100',
    'transition-transform delay-150 ease-in-out dura',
    className
  )}
  style={`transition-duration: ${duration}ms`}
  {...props}
  data-speed={speed}>
  <slot>
    <svg
      class='disabled linecap-round linejoin-round vector-non-scaling-stroke'
      xmlns='http://www.w3.org/2000/svg'
      width={size}
      height={size}
      viewBox='0 0 24 24'
      fill='currentColor'>
      <path d='M8 21v-2h8v2H8m0-4v-2h8v2H8m0-4v-2h8v2H8m11-4H5l7-7l7 7Z'></path>
    </svg>
  </slot>
</button>

<script>
  import { toTop } from '../../utils/scroll';

  class AppToTop extends HTMLButtonElement {
    constructor() {
      super();
    }

    get speed() {
      return this.dataset.speed ? parseInt(this.dataset.speed) : 1000;
    }

    connectedCallback() {
      this.addEventListener('click', (ev: MouseEvent | ToggleEvent) => {
        ev.preventDefault();
        toTop({ duration: this.speed });
      });
    }
  }

  customElements.define('app-to-top', AppToTop, { extends: 'button' });
</script>
