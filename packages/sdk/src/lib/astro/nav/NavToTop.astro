---
import type { HTMLAttributes } from 'astro/types';
import twMerge from '../../tailwind/tailwind-merge';

type Props = Omit<HTMLAttributes<'button'>, 'class'> & {
  class?: ClassName;
  label?: string;
  duration?: number;
  speed?: number;
};
const {
  class: className,
  label = 'to top',
  duration = 300,
  speed: __speed,
  ...props
} = Astro.props;

const speed = __speed ?? duration * 5;
---

<button
  is='app-to-top'
  class={twMerge(
    'flex absolute top-full z-10 w-10',
    'disabled scale-0 origin-center opacity-50 hover:opacity-100',
    'onscroll:enabled onscroll:scale-100',
    'transition-transform delay-150 ease-in-out dura',
    className
  )}
  style={`transition-duration: ${duration}ms`}
  aria-label={label}
  data-speed={speed}
  {...props}>
  <slot>
    <svg
      class='disabled linecap-round linejoin-round vector-non-scaling-stroke w-full'
      xmlns='http://www.w3.org/2000/svg'
      viewBox='0 0 24 24'
      fill='currentColor'>
      <path d='M8 21v-2h8v2H8m0-4v-2h8v2H8m0-4v-2h8v2H8m11-4H5l7-7l7 7Z'></path>
    </svg>
  </slot>
</button>

<script>
  import { toTop } from '../../utils/scroll';

  class AppToTop extends HTMLButtonElement {
    constructor() {
      super();
    }

    get speed() {
      return this.dataset.speed ? parseInt(this.dataset.speed) : 1000;
    }

    connectedCallback() {
      this.addEventListener('click', this.handle);
    }

    disconnectedCallback() {
      this.removeEventListener('click', this.handle);
    }

    handle = (ev: Event) => {
      ev.preventDefault();
      toTop({ duration: this.speed });
    };
  }

  customElements.define('app-to-top', AppToTop, { extends: 'button' });
</script>
