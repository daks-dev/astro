---
import twMerge from '../../tailwind/tailwind-merge';

type Props = {
  class?: ClassName;
  custom?: Record<string, ClassName>;
  size?: number;
};
const { class: className, custom, size = 32 } = Astro.props;
---

<button
  class={twMerge(custom?.icon, custom?.toggle, className)}
  aria-label='menu toggle'
  aria-expanded={true}
  aria-controls='[data-navbar-menu]'
  data-navbar-toggle>
  <slot>
    <svg
      xmlns='http://www.w3.org/2000/svg'
      width={size}
      height={size}
      viewBox='0 0 24 24'
      fill='currentColor'>
      <path
        class='transition-opacity duration-200 ease-in-out'
        d='M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z'
      ></path>
      <path
        class='transition-opacity duration-200 ease-in-out'
        style='opacity: 0'
        d='M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z'
      ></path>
    </svg>
  </slot>
</button>

<script>
  import { site } from '../../app/stores';

  const node = document.querySelector('[data-navbar-toggle]');

  if (node) {
    node.addEventListener('click', () => site.setKey('navbar.hidden', !site.get().navbar.hidden));

    const paths = node?.querySelectorAll('path');

    site.listen((val, key) => {
      if (key === 'navbar.hidden') {
        console.log('hidden: ', val.navbar.hidden);
        paths.forEach(
          (el, i) => (el.style.opacity = val.navbar.hidden ? (i ? '0' : '') : i ? '' : '0')
        );
      }
    });
  }
</script>
